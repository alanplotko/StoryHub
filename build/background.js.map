{"version":3,"file":"background.js","sources":["/home/drazard/GitHub/StoryHub/app/background.js"],"sourcesContent":["var app = require('app');  // Module to control application life.\nvar BrowserWindow = require('browser-window');  // Module to create native browser window.\nvar request = require('superagent'); // Module to make requests to GitHub\nvar LocalStorage = require('node-localstorage').LocalStorage; // Module to emulate LocalStorage for the app\nvar shLocalStorage = new LocalStorage('./StoryHub');\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\nvar mainWindow = null;\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function() {\n    // On OS X it is common for applications and their menu bar\n    // to stay active until the user quits explicitly with Cmd + Q\n    if (process.platform != 'darwin') {\n        app.quit();\n    }\n});\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\napp.on('ready', function() {\n    // Your GitHub Applications Credentials\n    var options = {\n        client_id: process.env['STORYHUB_CLIENTID'],\n        client_secret: process.env['STORYHUB_CLIENTSECRET'],\n        scopes: [\"user:email\", \"notifications\", \"public_repo\"]\n    }\n\n    // Build the OAuth consent page URL\n    var authWindow = new BrowserWindow({ width: 800, height: 600, show: false, 'node-integration': false });\n    var githubUrl = 'https://github.com/login/oauth/authorize?';\n    var authUrl = githubUrl + 'client_id=' + options.client_id + '&scope=' + options.scopes;\n    authWindow.loadUrl(authUrl);\n    authWindow.show();\n\n    // Handle the response from GitHub\n    authWindow.webContents.on('did-get-redirect-request', function(event, oldUrl, newUrl) {\n        var raw_code = /code=([^&]*)/.exec(newUrl) || null,\n        code = (raw_code && raw_code.length > 1) ? raw_code[1] : null,\n        error = /\\?error=(.+)$/.exec(newUrl);\n\n        // If there is a code in the callback, proceed to get token from github\n        if (code) {\n            request.post('https://github.com/login/oauth/access_token', {\n                client_id: options.client_id,\n                client_secret: options.client_secret,\n                code: code\n            }).end(function (err, response) {\n                if (response && response.ok) {\n                    console.log(response);\n                    // Successfully received token; store it\n                    shLocalStorage.setItem('githubtoken', response.body.access_token);\n\n                    // Create the browser window\n                    mainWindow = new BrowserWindow({\n                        width: 800,\n                        height: 600,\n                        'min-width': 500,\n                        'min-height': 200,\n                        'accept-first-mouse': true,\n                        'title-bar-style': 'hidden'\n                    });\n\n                    authWindow.close();\n\n                    // and load the index.html of the app.\n                    mainWindow.loadUrl('file://' + __dirname + '/index.html');\n\n                    // Open the DevTools.\n                    //mainWindow.openDevTools();\n\n                    // Emitted when the window is closed.\n                    mainWindow.on('closed', function() {\n                        // Dereference the window object, usually you would store windows\n                        // in an array if your app supports multi windows, this is the time\n                        // when you should delete the corresponding element.\n                        mainWindow = null;\n                    });\n                }\n                else {\n                    // Error, show messages\n                    console.log(err);\n                }\n            });\n        }\n        else if (error) {\n            alert(\"Oops! Something went wrong and we couldn't log you in using Github. Please try again.\");\n        }\n    });\n    // Reset the authWindow on close\n    authWindow.on('close', function() {\n        authWindow = null;\n    }, false);\n});\n"],"names":[],"mappings":"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"}